<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="WATEN — Premium streetwear built for global dominance. Limited drops. Strong brand identity." id="meta-description">
<title>WATEN | Global Streetwear</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #0a0a0a;
  --bg-card: #141414;
  --accent: #c9a227;
  --accent-hover: #d4af37;
  --text: #f5f5f5;
  --text-muted: rgba(255,255,255,0.65);
  --border: rgba(255,255,255,0.08);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: var(--bg-dark); color: var(--text); overflow-x: hidden; font-family: 'DM Sans', sans-serif; font-weight: 400; line-height: 1.6; cursor: none; }
html { scroll-behavior: smooth; }

/* Custom Cursor */
.cursor {
  width: 20px; height: 20px; border: 2px solid var(--accent);
  border-radius: 50%; position: fixed; pointer-events: none;
  z-index: 9999; transition: transform 0.1s ease;
  transform: translate(-50%, -50%);
}
.cursor-follower {
  width: 40px; height: 40px; background: rgba(201, 162, 39, 0.1);
  border-radius: 50%; position: fixed; pointer-events: none;
  z-index: 9998; transition: transform 0.3s ease;
  transform: translate(-50%, -50%);
}

/* Floating Fashion Items */
.fashion-item {
  position: fixed; pointer-events: none; z-index: 5;
  opacity: 0.7; transition: all 0.3s ease;
  font-size: 2rem; color: var(--accent);
  display: flex; align-items: center; justify-content: center;
}

/* T-Shirt Shape */
.tshirt {
  width: 60px; height: 70px;
  background: var(--accent);
  position: relative;
  clip-path: polygon(
    20% 0%, 80% 0%, 100% 25%, 100% 100%, 0% 100%, 0% 25%
  );
}

.tshirt::before {
  content: ''; position: absolute;
  width: 25px; height: 30px;
  background: var(--bg-dark);
  top: 0; left: 50%; transform: translateX(-50%);
  clip-path: polygon(0% 0%, 100% 0%, 80% 100%, 20% 100%);
}

/* Hoodie Shape */
.hoodie {
  width: 65px; height: 75px;
  background: var(--accent);
  position: relative;
  border-radius: 10px 10px 0 0;
}

.hoodie::before {
  content: ''; position: absolute;
  width: 30px; height: 35px;
  background: var(--bg-dark);
  top: -10px; left: 50%; transform: translateX(-50%);
  border-radius: 50% 50% 0 0;
}

.hoodie::after {
  content: ''; position: absolute;
  width: 8px; height: 40px;
  background: var(--accent);
  top: 10px; left: -5px;
  border-radius: 4px;
}

/* Single Item (Pants) */
.single {
  width: 50px; height: 80px;
  background: var(--accent);
  position: relative;
  clip-path: polygon(
    10% 0%, 40% 0%, 35% 50%, 50% 50%, 65% 50%, 60% 0%, 90% 0%,
    85% 100%, 60% 100%, 55% 55%, 45% 55%, 40% 100%, 15% 100%
  );
}

/* Floating Animation */
.floating {
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  25% { transform: translateY(-20px) rotate(2deg); }
  50% { transform: translateY(-10px) rotate(-1deg); }
  75% { transform: translateY(-15px) rotate(1deg); }
}

/* Parallax Layers */
.parallax-layer {
  position: absolute; inset: 0; pointer-events: none;
}
.parallax-layer.layer-1 { z-index: 2; }
.parallax-layer.layer-2 { z-index: 3; }
.parallax-layer.layer-3 { z-index: 4; }

.floating-item {
  position: absolute; font-size: 0.8rem; color: var(--accent);
  font-weight: 600; letter-spacing: 0.1em; opacity: 0.7;
  transition: all 0.5s ease;
}

header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 1.25rem 6%; position: fixed; width: 100%;
  background: rgba(10,10,10,0.85); backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border); z-index: 1000;
  transition: padding 0.3s ease;
}
.logo { font-family: 'Cormorant Garamond', serif; font-size: 1.75rem; font-weight: 700; letter-spacing: 0.35em; }
nav { display: flex; gap: 2.5rem; }
nav a {
  color: var(--text); text-decoration: none; font-size: 0.75rem; font-weight: 500;
  letter-spacing: 0.2em; text-transform: uppercase; transition: color 0.25s ease;
}
nav a:hover { color: var(--accent); }

section { padding: 7rem 6%; opacity: 0; transform: translateY(40px); transition: opacity 0.8s ease, transform 0.8s ease; }
section.show { opacity: 1; transform: translateY(0); }

.hero {
  min-height: 100vh; background: url('https://images.unsplash.com/photo-1520975922284-1a7d61c2f6b5') center/cover no-repeat;
  display: flex; align-items: center; justify-content: center; text-align: center; position: relative;
}
#canvas-container {
  position: absolute; inset: 0; z-index: 1;
}
.hero::after {
  content: ""; position: absolute; inset: 0; z-index: 2;
  background: linear-gradient(180deg, rgba(10,10,10,0.4) 0%, rgba(10,10,10,0.85) 100%);
}
.hero-content { position: relative; z-index: 10; max-width: 900px; }
.hero h1 { font-family: 'Cormorant Garamond', serif; font-size: clamp(3.5rem, 10vw, 6rem); font-weight: 700; letter-spacing: 0.2em; line-height: 1.1; }
.hero .tagline { margin-top: 1.25rem; font-size: 0.8rem; letter-spacing: 0.35em; color: var(--text-muted); font-weight: 500; }
.btn {
  margin-top: 2.5rem; padding: 1rem 2.5rem; background: transparent;
  border: 1.5px solid var(--accent); color: var(--accent);
  font-family: 'DM Sans', sans-serif; font-size: 0.7rem; font-weight: 600; letter-spacing: 0.2em; text-transform: uppercase;
  cursor: pointer; transition: all 0.3s ease; position: relative; z-index: 15;
  box-shadow: 0 4px 15px rgba(201, 162, 39, 0.3); backdrop-filter: blur(10px);
}
.btn:hover { 
  background: var(--accent); color: var(--bg-dark); 
  transform: translateY(-2px); box-shadow: 0 6px 20px rgba(201, 162, 39, 0.4);
}

.section-header { margin-bottom: 3rem; }
.section-header h2 {
  font-family: 'Cormorant Garamond', serif; font-size: 1.75rem; font-weight: 600; letter-spacing: 0.15em;
  margin-bottom: 0.5rem;
}
.section-header .subtitle { font-size: 0.8rem; color: var(--text-muted); letter-spacing: 0.1em; }

.products { display: flex; gap: 2rem; flex-wrap: wrap; margin-top: 3rem; justify-content: center; }
.product {
  width: 320px; background: var(--bg-card); cursor: pointer; overflow: hidden;
  position: relative; transition: transform 0.35s ease; border: 1px solid var(--border);
}
.product:hover { transform: translateY(-4px); }
.product:hover img { transform: scale(1.05); }
.product-image { width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #1a1a1a; }
.product img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
.product-details { padding: 1.5rem 1.25rem; }
.product-details .name { font-size: 0.85rem; letter-spacing: 0.15em; font-weight: 600; margin-bottom: 0.35rem; }
.product-details .price { font-size: 0.9rem; color: var(--accent); font-weight: 600; }

.modal {
  position: fixed; inset: 0; background: rgba(0,0,0,0.92); display: none;
  align-items: center; justify-content: center; z-index: 2000;
  backdrop-filter: blur(8px); padding: 2rem;
}
.modal-content {
  background: var(--bg-card); padding: 2.5rem; max-width: 600px; width: 100%;
  text-align: left; border: 1px solid var(--border);
  max-height: 90vh; overflow-y: auto;
}
.modal-content h3 { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; margin-bottom: 0.5rem; letter-spacing: 0.1em; }
.modal-content .price { font-size: 1.1rem; color: var(--accent); font-weight: 600; margin-bottom: 1.5rem; }
.close {
  cursor: pointer; margin-bottom: 1.5rem; display: inline-block; color: var(--text-muted);
  font-size: 0.7rem; letter-spacing: 0.15em; transition: color 0.25s;
}
.close:hover { color: var(--accent); }

/* Order Form Styling */
.order-form {
  display: flex; flex-direction: column; gap: 1.5rem;
}
.form-group {
  display: flex; flex-direction: column; gap: 0.5rem;
}
.form-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;
}
.form-group label {
  font-size: 0.85rem; font-weight: 500; letter-spacing: 0.05em; color: var(--text);
}
.form-group input,
.form-group select,
.form-group textarea {
  padding: 0.75rem 1rem; background: var(--bg-dark);
  border: 1px solid var(--border); color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 0.9rem;
  border-radius: 4px; transition: all 0.3s ease;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none; border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(201, 162, 39, 0.1);
}
.form-group textarea {
  resize: vertical; min-height: 80px;
}

/* Order Summary */
.order-summary {
  background: var(--bg-dark); padding: 1.5rem; border-radius: 8px;
  border: 1px solid var(--border); margin: 1rem 0;
}
.summary-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 0.5rem 0; font-size: 0.9rem;
}
.summary-row.total {
  border-top: 1px solid var(--border); margin-top: 0.5rem;
  padding-top: 1rem; font-weight: 600; font-size: 1rem; color: var(--accent);
}
.confirm-order-btn {
  width: 100%; padding: 1rem 2rem; background: var(--accent);
  color: var(--bg-dark); border: none; font-weight: 600;
  letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
  transition: all 0.3s ease; margin-top: 1rem;
}
.confirm-order-btn:hover {
  background: var(--accent-hover); transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(201, 162, 39, 0.3);
}

.cart {
  position: fixed; top: 1.25rem; right: 6%; background: var(--accent); color: var(--bg-dark);
  padding: 0.6rem 1.25rem; cursor: pointer; font-weight: 600; z-index: 2000;
  font-size: 0.7rem; letter-spacing: 0.15em; transition: background 0.25s;
}
.cart:hover { background: var(--accent-hover); }

.invest-section { text-align: center; max-width: 640px; margin: 0 auto; }
.invest-section h2 { font-family: 'Cormorant Garamond', serif; font-size: 1.75rem; letter-spacing: 0.15em; margin-bottom: 1.25rem; }
.invest-section p { color: var(--text-muted); font-size: 0.95rem; line-height: 1.75; margin-bottom: 1.5rem; }

footer {
  padding: 4rem 6% 2rem; background: #050505; border-top: 1px solid var(--border);
  display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 2rem;
}
.footer-brand { flex: 1; min-width: 200px; }
.footer-brand .logo { font-size: 1.25rem; margin-bottom: 0.5rem; }
.footer-brand p { font-size: 0.75rem; color: var(--text-muted); letter-spacing: 0.05em; }
.footer-social { margin-top: 0.75rem; display: flex; flex-direction: column; gap: 0.25rem; }
.footer-social a { color: var(--text-muted); text-decoration: none; font-size: 0.8rem; letter-spacing: 0.05em; }
.footer-social a:hover { color: var(--accent); }
.footer-links { display: flex; gap: 2rem; }
.footer-links a { color: var(--text-muted); text-decoration: none; font-size: 0.75rem; letter-spacing: 0.1em; transition: color 0.25s; }
.footer-links a:hover { color: var(--accent); }
.footer-bottom { width: 100%; padding-top: 2rem; margin-top: 2rem; border-top: 1px solid var(--border); text-align: center; }
.footer-bottom span { font-size: 0.7rem; color: var(--text-muted); letter-spacing: 0.1em; }

@media (max-width: 768px) {
  header { padding: 1rem 5%; }
  nav { gap: 1.5rem; }
  .hero h1 { letter-spacing: 0.12em; }
  .products { gap: 1.5rem; }
  .product { width: 100%; max-width: 340px; }
  .cart { right: 5%; }
  footer { flex-direction: column; text-align: center; }
  .footer-links { justify-content: center; }
  .footer-social { align-items: center; }
  
  /* Mobile Order Form */
  .modal-content {
    padding: 1.5rem; margin: 1rem; max-width: none;
  }
  .form-row {
    grid-template-columns: 1fr; gap: 0;
  }
  .order-form {
    gap: 1rem;
  }
  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: 0.6rem 0.8rem; font-size: 0.85rem;
  }
}
</style>
</head>
<body>

<!-- Custom Cursor -->
<div class="cursor"></div>
<div class="cursor-follower"></div>

<!-- Floating Clothing Items Only -->
<div class="fashion-item tshirt floating" style="top: 15%; left: 10%;"></div>
<div class="fashion-item hoodie floating" style="top: 25%; right: 15%;"></div>
<div class="fashion-item single floating" style="top: 60%; left: 80%;"></div>
<div class="fashion-item tshirt floating" style="top: 70%; right: 25%;"></div>
<div class="fashion-item hoodie floating" style="top: 35%; left: 25%;"></div>
<div class="fashion-item single floating" style="top: 45%; right: 30%;"></div>
<div class="fashion-item tshirt floating" style="bottom: 20%; left: 40%;"></div>
<div class="fashion-item hoodie floating" style="bottom: 25%; right: 35%;"></div>

<!-- Parallax Layers -->
<div class="parallax-layer layer-1">
  <div class="floating-item" style="top: 15%; left: 20%;">STREETWEAR</div>
  <div class="floating-item" style="top: 25%; right: 30%;">LUXURY</div>
  <div class="floating-item" style="bottom: 30%; left: 15%;">COUTURE</div>
</div>
<div class="parallax-layer layer-2">
  <div class="floating-item" style="top: 40%; right: 20%;">FASHION</div>
  <div class="floating-item" style="bottom: 20%; left: 25%;">STYLE</div>
</div>
<div class="parallax-layer layer-3">
  <div class="floating-item" style="top: 50%; left: 50%;">WATEN</div>
</div>

<div class="cart" onclick="viewCart()">Cart (<span id="cart-count">0</span>)</div>

<header>
<div class="logo" id="header-logo">WATEN</div>
<nav id="header-nav">
<a href="#collection">COLLECTION</a>
<a href="#invest">INVEST</a>
</nav>
</header>

<section class="hero show" id="hero-section">
<div id="canvas-container"></div>
<div class="hero-content">
<h1 id="hero-title">WATEN</h1>
<p class="tagline" id="hero-tagline">Built for global dominance</p>
<button class="btn" id="hero-cta" onclick="scrollToCollection()">Shop Now</button>
</div>
</section>

<section id="collection">
<div class="section-header">
<h2 id="collection-heading">New Drop</h2>
<p class="subtitle" id="collection-subtitle">Limited edition pieces — available now</p>
</div>
<div class="products" id="productsContainer">
<div class="empty-products" style="text-align:center;padding:3rem;color:rgba(255,255,255,0.5);">Loading...</div>
</div>
</section>

<section id="invest">
<div class="invest-section">
<h2 id="invest-heading">Invest in WATEN</h2>
<p id="invest-body">WATEN is positioned for aggressive expansion across Tunisia and international markets. High-margin model. Limited drops. Strong brand identity. Seeking strategic investors to scale retail and global distribution.</p>
<button class="btn" id="invest-cta">Request Pitch Deck</button>
</div>
</section>

<footer>
<div class="footer-brand">
<div class="logo" id="footer-logo">WATEN</div>
<p id="footer-tagline">Premium streetwear. Limited drops. Global reach.</p>
<div class="footer-social" id="footer-social">
  <a id="footer-whatsapp" href="#" target="_blank" style="display:none;">WhatsApp</a>
  <a id="footer-instagram" href="#" target="_blank" style="display:none;">Instagram</a>
  <a id="footer-tiktok" href="#" target="_blank" style="display:none;">TikTok</a>
  <a id="footer-email" href="#" style="display:none;">Email</a>
</div>
</div>
<nav class="footer-links" id="footer-links">
<a href="#collection">Collection</a>
<a href="#invest">Invest</a>
</nav>
<div class="footer-bottom">
<span id="footer-copyright">© 2026 WATEN — Global Streetwear</span>
</div>
</footer>

<div class="modal" id="productModal">
<div class="modal-content">
<span class="close" onclick="closeProduct()">Close</span>
<div class="order-form">
  <h3 id="productName"></h3>
  <p class="price" id="productPrice"></p>
  
  <form id="orderForm" onsubmit="submitOrder(event)">
    <div class="form-group">
      <label for="customerName">Full Name *</label>
      <input type="text" id="customerName" name="customerName" required>
    </div>
    
    <div class="form-group">
      <label for="phoneNumber">Phone Number *</label>
      <input type="tel" id="phoneNumber" name="phoneNumber" required>
    </div>
    
    <div class="form-group">
      <label for="email">Email Address</label>
      <input type="email" id="email" name="email">
    </div>
    
    <div class="form-group">
      <label for="address">Street Address *</label>
      <input type="text" id="address" name="address" required>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="city">City *</label>
        <input type="text" id="city" name="city" required>
      </div>
      
      <div class="form-group">
        <label for="postalCode">Postal Code *</label>
        <input type="text" id="postalCode" name="postalCode" required>
      </div>
    </div>
    
    <div class="form-group">
      <label for="quantity">Quantity *</label>
      <select id="quantity" name="quantity" required>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="notes">Order Notes (Optional)</label>
      <textarea id="notes" name="notes" rows="3" placeholder="Special instructions or delivery notes..."></textarea>
    </div>
    
    <div class="order-summary">
      <div class="summary-row">
        <span>Unit Price:</span>
        <span id="unitPrice">0 TND</span>
      </div>
      <div class="summary-row">
        <span>Quantity:</span>
        <span id="summaryQuantity">1</span>
      </div>
      <div class="summary-row total">
        <span>Total:</span>
        <span id="totalPrice">0 TND</span>
      </div>
    </div>
    
    <button type="submit" class="btn confirm-order-btn">Confirm Order</button>
  </form>
</div>
</div>
</div>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let currentProduct = {};
let siteContent = null;

function applySiteContent(site) {
  if (!site) return;
  if (site.meta) {
    if (site.meta.title) document.title = site.meta.title;
    var metaDesc = document.getElementById('meta-description');
    if (metaDesc && site.meta.description) metaDesc.setAttribute('content', site.meta.description);
  }
  if (site.header) {
    var logo = document.getElementById('header-logo');
    if (logo && site.header.logoText) logo.textContent = site.header.logoText;
    var nav = document.getElementById('header-nav');
    if (nav && site.header.navLinks && site.header.navLinks.length) {
      nav.innerHTML = site.header.navLinks.map(function(l) {
        return '<a href="' + (l.href || '#').replace(/"/g, '&quot;') + '">' + (l.label || '').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</a>';
      }).join('');
    }
  }
  if (site.hero) {
    var heroTitle = document.getElementById('hero-title');
    if (heroTitle && site.hero.title) heroTitle.textContent = site.hero.title;
    var heroTag = document.getElementById('hero-tagline');
    if (heroTag && site.hero.tagline !== undefined) heroTag.textContent = site.hero.tagline;
    var heroCta = document.getElementById('hero-cta');
    if (heroCta && site.hero.ctaText) heroCta.textContent = site.hero.ctaText;
    var heroSec = document.getElementById('hero-section');
    if (heroSec && site.hero.backgroundImage) heroSec.style.backgroundImage = "url('" + site.hero.backgroundImage.replace(/'/g, "\\'") + "')";
  }
  if (site.collection) {
    var ch = document.getElementById('collection-heading');
    if (ch && site.collection.heading !== undefined) ch.textContent = site.collection.heading;
    var cs = document.getElementById('collection-subtitle');
    if (cs && site.collection.subtitle !== undefined) cs.textContent = site.collection.subtitle;
  }
  if (site.invest) {
    var ih = document.getElementById('invest-heading');
    if (ih && site.invest.heading !== undefined) ih.textContent = site.invest.heading;
    var ib = document.getElementById('invest-body');
    if (ib && site.invest.body !== undefined) ib.textContent = site.invest.body;
    var icta = document.getElementById('invest-cta');
    if (icta && site.invest.ctaText !== undefined) icta.textContent = site.invest.ctaText;
  }
  if (site.footer) {
    var fl = document.getElementById('footer-logo');
    if (fl && site.footer.logoText !== undefined) fl.textContent = site.footer.logoText;
    var ft = document.getElementById('footer-tagline');
    if (ft && site.footer.tagline !== undefined) ft.textContent = site.footer.tagline;
    var flinks = document.getElementById('footer-links');
    if (flinks && site.footer.links && site.footer.links.length) {
      flinks.innerHTML = site.footer.links.map(function(l) {
        return '<a href="' + (l.href || '#').replace(/"/g, '&quot;') + '">' + (l.label || '').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</a>';
      }).join('');
    }
    var fc = document.getElementById('footer-copyright');
    if (fc && site.footer.copyright !== undefined) fc.textContent = site.footer.copyright;
  }
  if (site.social) {
    var wrap = document.getElementById('footer-social');
    var any = false;
    function setLink(id, url, text, isEmail) {
      var el = document.getElementById(id);
      if (!el) return;
      if (url && url.trim()) {
        any = true;
        var v = url.trim();
        if (isEmail && v.indexOf('@') !== -1 && !v.startsWith('mailto:')) {
          el.href = 'mailto:' + v;
        } else {
          el.href = v;
        }
        if (text) el.textContent = text;
        el.style.display = 'inline-block';
      } else {
        el.style.display = 'none';
      }
    }
    setLink('footer-whatsapp', site.social.whatsapp, 'WhatsApp', false);
    setLink('footer-instagram', site.social.instagram, 'Instagram', false);
    setLink('footer-tiktok', site.social.tiktok, 'TikTok', false);
    setLink('footer-email', site.social.email, 'Email', true);
    if (wrap) wrap.style.display = any ? 'flex' : 'none';
  }
}

async function loadSiteContent() {
  try {
    var res = await fetch('/api/site');
    siteContent = await res.json();
    if (siteContent && Object.keys(siteContent).length) applySiteContent(siteContent);
  } catch (e) {}
}

loadSiteContent();

const FALLBACK_PRODUCTS = [
  { name: 'Black Essential Hoodie', price: 120, image: 'https://images.unsplash.com/photo-1602810319428-019690571b5b' },
  { name: 'Oversized Street Tee', price: 80, image: 'https://images.unsplash.com/photo-1593032465171-8f8b8fdd6b47' },
  { name: 'Limited Varsity Jacket', price: 250, image: 'images/iyadh.jpg' },
  { name: 'Tataouine 3200 Hoodie', price: 140, image: '12.png' }
];
const FALLBACK_IMG = 'https://images.unsplash.com/photo-1556821840-3a63f95609a7';

async function loadProducts() {
  const container = document.getElementById('productsContainer');
  try {
    const res = await fetch('/api/products');
    const products = await res.json();
    renderProducts(products.length ? products : FALLBACK_PRODUCTS);
  } catch (e) {
    renderProducts(FALLBACK_PRODUCTS);
  }
}

function renderProducts(products) {
  const container = document.getElementById('productsContainer');
  container.innerHTML = products.map(p => {
    const name = (p.name || '').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    const img = (p.image || FALLBACK_IMG).replace(/"/g, '&quot;');
    const data = JSON.stringify({ name: p.name, price: p.price }).replace(/"/g, '&quot;');
    return `<div class="product" data-product="${data}" onclick="openProductFromEl(this)">
      <div class="product-image"><img src="${img}" alt="${name}" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'"></div>
      <div class="product-details">
        <div class="name">${name}</div>
        <div class="price">${p.price} TND</div>
      </div>
    </div>`;
  }).join('');
}

function openProductFromEl(el) {
  const p = JSON.parse(el.dataset.product);
  openProduct(p.name, p.price);
}

loadProducts();

// Live update: refetch products when tab is visible again (e.g. after editing in dashboard)
document.addEventListener('visibilitychange', function() {
  if (document.visibilityState === 'visible') loadProducts();
});
// Optional: refresh product list every 60s while page is open so store stays in sync
setInterval(loadProducts, 60000);

function scrollToCollection() {
  document.getElementById('collection').scrollIntoView({ behavior: 'smooth' });
}

function openProduct(name, price) {
  currentProduct = { name, price };
  document.getElementById('productName').innerText = name;
  document.getElementById('productPrice').innerText = price + ' TND';
  document.getElementById('unitPrice').innerText = price + ' TND';
  document.getElementById('totalPrice').innerText = price + ' TND';
  document.getElementById('productModal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
  
  // Reset form
  document.getElementById('orderForm').reset();
  document.getElementById('summaryQuantity').innerText = '1';
}

function closeProduct() {
  document.getElementById('productModal').style.display = 'none';
  document.body.style.overflow = '';
}

// Update order summary when quantity changes
document.addEventListener('DOMContentLoaded', function() {
  const quantitySelect = document.getElementById('quantity');
  if (quantitySelect) {
    quantitySelect.addEventListener('change', updateOrderSummary);
  }
});

function updateOrderSummary() {
  const quantity = parseInt(document.getElementById('quantity').value);
  const unitPrice = currentProduct.price || 0;
  const totalPrice = unitPrice * quantity;
  
  document.getElementById('summaryQuantity').innerText = quantity;
  document.getElementById('totalPrice').innerText = totalPrice + ' TND';
}

function submitOrder(event) {
  event.preventDefault();
  
  // Get form data
  const formData = new FormData(event.target);
  const orderData = {
    product: currentProduct,
    customer: {
      name: formData.get('customerName'),
      phone: formData.get('phoneNumber'),
      email: formData.get('email'),
      address: formData.get('address'),
      city: formData.get('city'),
      postalCode: formData.get('postalCode')
    },
    quantity: parseInt(formData.get('quantity')),
    notes: formData.get('notes'),
    totalPrice: currentProduct.price * parseInt(formData.get('quantity')),
    orderDate: new Date().toISOString()
  };
  
  // Save order to localStorage (in a real app, this would be sent to a server)
  const orders = JSON.parse(localStorage.getItem('orders')) || [];
  orders.push(orderData);
  localStorage.setItem('orders', JSON.stringify(orders));
  
  // Show confirmation message
  alert(`Order confirmed!\n\nProduct: ${orderData.product.name}\nQuantity: ${orderData.quantity}\nTotal: ${orderData.totalPrice} TND\n\nWe'll contact you soon at ${orderData.customer.phone}`);
  
  // Close modal and reset
  closeProduct();
  
  // Optional: Update cart count if you want to track orders
  const cartCount = document.getElementById('cart-count');
  if (cartCount) {
    cartCount.innerText = orders.length;
  }
}

function viewCart() {
  if (cart.length === 0) {
    alert('Your cart is empty.');
    return;
  }
  alert('Cart Items:\n' + cart.map(p => p.name + ' — ' + p.price + ' TND').join('\n'));
}

document.getElementById('cart-count').innerText = cart.length;

// Close modal on backdrop click
document.getElementById('productModal').addEventListener('click', function(e) {
  if (e.target === this) closeProduct();
});

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeProduct();
});

const sections = document.querySelectorAll('section');
window.addEventListener('scroll', function() {
  sections.forEach(function(sec) {
    const top = sec.getBoundingClientRect().top;
    if (top < window.innerHeight - 100) sec.classList.add('show');
  });
});

// 3D Background Animation with Geometric Shapes
let scene, camera, renderer, shapes = [];
let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

function init3DBackground() {
  const container = document.getElementById('canvas-container');
  if (!container) return;

  // Skip 3D on low-end devices
  if (isMobile && window.innerWidth < 768) {
    container.style.display = 'none';
    return;
  }

  scene = new THREE.Scene();
  scene.fog = new THREE.Fog(0x0a0a0a, 1, 15);
  
  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.z = 8;

  renderer = new THREE.WebGLRenderer({ 
    alpha: true, 
    antialias: !isMobile,
    powerPreference: "high-performance"
  });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(isMobile ? 1 : Math.min(window.devicePixelRatio, 2));
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  container.appendChild(renderer.domElement);

  // Lighting
  const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
  scene.add(ambientLight);

  const pointLight1 = new THREE.PointLight(0xc9a227, 2, 20);
  pointLight1.position.set(5, 5, 5);
  pointLight1.castShadow = true;
  scene.add(pointLight1);

  const pointLight2 = new THREE.PointLight(0xff6b35, 1.5, 15);
  pointLight2.position.set(-5, -3, 3);
  scene.add(pointLight2);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.3);
  directionalLight.position.set(0, 5, 5);
  directionalLight.castShadow = true;
  scene.add(directionalLight);

  // Create geometric shapes
  const shapeCount = isMobile ? 8 : 15;
  
  for (let i = 0; i < shapeCount; i++) {
    const geometryType = Math.random();
    let geometry, material, mesh;

    if (geometryType < 0.33) {
      // Cube
      geometry = new THREE.BoxGeometry(
        Math.random() * 1.5 + 0.5,
        Math.random() * 1.5 + 0.5,
        Math.random() * 1.5 + 0.5
      );
    } else if (geometryType < 0.66) {
      // Torus
      geometry = new THREE.TorusGeometry(
        Math.random() * 0.8 + 0.3,
        Math.random() * 0.3 + 0.1,
        8, 16
      );
    } else {
      // Octahedron
      geometry = new THREE.OctahedronGeometry(Math.random() * 0.8 + 0.4);
    }

    material = new THREE.MeshPhongMaterial({
      color: Math.random() > 0.5 ? 0xc9a227 : 0xff6b35,
      emissive: Math.random() > 0.5 ? 0xc9a227 : 0xff6b35,
      emissiveIntensity: 0.2,
      shininess: 100,
      transparent: true,
      opacity: isMobile ? 0.6 : 0.8,
      wireframe: Math.random() > 0.7
    });

    mesh = new THREE.Mesh(geometry, material);
    
    // Random position
    mesh.position.x = (Math.random() - 0.5) * 12;
    mesh.position.y = (Math.random() - 0.5) * 8;
    mesh.position.z = (Math.random() - 0.5) * 6;
    
    // Random rotation
    mesh.rotation.x = Math.random() * Math.PI * 2;
    mesh.rotation.y = Math.random() * Math.PI * 2;
    
    // Random velocity for animation
    mesh.userData = {
      rotationSpeed: {
        x: (Math.random() - 0.5) * 0.02,
        y: (Math.random() - 0.5) * 0.02,
        z: (Math.random() - 0.5) * 0.02
      },
      floatSpeed: Math.random() * 0.001 + 0.0005,
      floatAmount: Math.random() * 0.5 + 0.2
    };
    
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    
    shapes.push(mesh);
    scene.add(mesh);
  }

  // Mouse movement (reduced on mobile)
  if (!isMobile) {
    document.addEventListener('mousemove', (event) => {
      mouseX = (event.clientX / window.innerWidth - 0.5) * 2;
      mouseY = (event.clientY / window.innerHeight - 0.5) * 2;
    });
  }

  // Handle resize with debouncing
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }, 250);
  });

  // Handle visibility change to pause when tab is not visible
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      renderer.dispose();
    } else {
      animate3D();
    }
  });

  animate3D();
}

function animate3D() {
  if (document.hidden) return;
  requestAnimationFrame(animate3D);

  const time = Date.now() * 0.001;

  // Animate shapes
  shapes.forEach((shape, index) => {
    // Rotation
    shape.rotation.x += shape.userData.rotationSpeed.x;
    shape.rotation.y += shape.userData.rotationSpeed.y;
    shape.rotation.z += shape.userData.rotationSpeed.z;

    // Floating animation
    shape.position.y += Math.sin(time * shape.userData.floatSpeed + index) * shape.userData.floatAmount * 0.01;
    shape.position.x += Math.cos(time * shape.userData.floatSpeed * 0.7 + index) * shape.userData.floatAmount * 0.005;

    // Mouse interaction
    if (!isMobile) {
      shape.rotation.x += mouseY * 0.01;
      shape.rotation.y += mouseX * 0.01;
    }
  });

  // Subtle camera movement
  camera.position.x = Math.sin(time * 0.1) * 0.5;
  camera.position.y = Math.cos(time * 0.15) * 0.3;
  camera.lookAt(scene.position);

  renderer.render(scene, camera);
}

// Initialize 3D background when page loads
window.addEventListener('load', init3DBackground);

// Fashion Template Mouse Interactions
const cursor = document.querySelector('.cursor');
const cursorFollower = document.querySelector('.cursor-follower');
const fashionItems = document.querySelectorAll('.fashion-item');
const floatingTexts = document.querySelectorAll('.floating-item');
const parallaxLayers = document.querySelectorAll('.parallax-layer');

let mouseX = 0, mouseY = 0;
let currentX = 0, currentY = 0;

// Mouse movement tracking
document.addEventListener('mousemove', (e) => {
  mouseX = e.clientX;
  mouseY = e.clientY;
  
  // Update cursor position
  cursor.style.left = mouseX + 'px';
  cursor.style.top = mouseY + 'px';
  
  // Update cursor follower with lag
  setTimeout(() => {
    cursorFollower.style.left = mouseX + 'px';
    cursorFollower.style.top = mouseY + 'px';
  }, 100);
});

// Smooth cursor animation
function animateCursor() {
  currentX += (mouseX - currentX) * 0.1;
  currentY += (mouseY - currentY) * 0.1;
  
  requestAnimationFrame(animateCursor);
}
animateCursor();

// Fashion items mouse interaction
fashionItems.forEach((item, index) => {
  const initialX = parseFloat(item.style.left) || 0;
  const initialY = parseFloat(item.style.top) || 0;
  
  document.addEventListener('mousemove', (e) => {
    const moveX = (e.clientX - window.innerWidth / 2) / 50;
    const moveY = (e.clientY - window.innerHeight / 2) / 50;
    
    const offsetX = moveX * (index + 1) * 3;
    const offsetY = moveY * (index + 1) * 3;
    const rotation = (moveX + moveY) * (index + 1) * 2;
    
    item.style.transform = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation}deg) scale(${1 + Math.abs(moveX) * 0.01})`;
  });
});

// Parallax effect for floating text
parallaxLayers.forEach((layer, layerIndex) => {
  const items = layer.querySelectorAll('.floating-item');
  
  document.addEventListener('mousemove', (e) => {
    const moveX = (e.clientX - window.innerWidth / 2) / 100;
    const moveY = (e.clientY - window.innerHeight / 2) / 100;
    
    items.forEach((item, itemIndex) => {
      const speed = (layerIndex + 1) * 0.5;
      const offsetX = moveX * speed * (itemIndex + 1);
      const offsetY = moveY * speed * (itemIndex + 1);
      
      item.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${1 + Math.abs(offsetX) * 0.001})`;
      item.style.opacity = 0.7 + Math.abs(offsetX) * 0.1;
    });
  });
});

// Hover effects for interactive elements
document.querySelectorAll('a, button, .product').forEach(element => {
  element.addEventListener('mouseenter', () => {
    cursor.style.transform = 'translate(-50%, -50%) scale(1.5)';
    cursorFollower.style.transform = 'translate(-50%, -50%) scale(1.2)';
    
    // Make nearby fashion items glow
    fashionItems.forEach(item => {
      item.style.opacity = '0.9';
      item.style.filter = 'brightness(1.2)';
    });
  });
  
  element.addEventListener('mouseleave', () => {
    cursor.style.transform = 'translate(-50%, -50%) scale(1)';
    cursorFollower.style.transform = 'translate(-50%, -50%) scale(1)';
    
    // Reset fashion items
    fashionItems.forEach(item => {
      item.style.opacity = '0.7';
      item.style.filter = 'brightness(1)';
    });
  });
});

// Enhanced floating animation for clothing items
function animateFashionItems() {
  const time = Date.now() * 0.001;
  
  fashionItems.forEach((item, index) => {
    if (!item.classList.contains('floating')) return;
    
    const floatY = Math.sin(time + index * 0.5) * 15;
    const floatX = Math.cos(time * 0.7 + index * 0.3) * 10;
    const rotateZ = Math.sin(time * 0.3 + index) * 5;
    
    item.style.transform += ` translateY(${floatY}px) translateX(${floatX * 0.5}px) rotateZ(${rotateZ}deg)`;
  });
  
  requestAnimationFrame(animateFashionItems);
}
animateFashionItems();

// Hide default cursor on mobile
if (window.innerWidth > 768) {
  document.body.style.cursor = 'none';
} else {
  cursor.style.display = 'none';
  cursorFollower.style.display = 'none';
}
</script>

</body>
</html>
